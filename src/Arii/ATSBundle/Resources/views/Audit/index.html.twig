{% extends "AriiATSBundle::layout.html.twig" %}
{% block body %}
<script language="javascript">
function Init() {
    globalLayout.cells("c").setText("{{ "Audit" | trans}}");
    myTabbar = globalLayout.cells("c").attachTabbar();
    myTabbar.addTab("events","{{ "Events" | trans }}","120px",null,true);
    myTabbar.addTab("jobs","{{ "Jobs" | trans }}","120px");

    myGridEvents = myTabbar.cells("events").attachGrid();
    myGridEvents.setImagePath( "{{ asset('/images/') }}");
    myGridEvents.setHeader("{{ "Date" | trans }},{{ "Event" | trans }},{{ "Job" | trans }},{{ "Status" | trans }},{{ "Variable" | trans }},{{ "User" | trans }},{{ "Domain" | trans }},{{ "Comment" | trans }},{{ "Ins." | trans }}");
    myGridEvents.attachHeader("#text_filter,#select_filter,#text_filter,#select_filter,#text_filter,#select_filter,#select_filter,#text_filter,#select_filter");
    myGridEvents.setInitWidths("140,180,*,100,*,120,120,*,0");
    myGridEvents.setColAlign("left,left,left,left,left,left,left,left,left");
    myGridEvents.setColTypes("ro,ro,ro,ro,ro,ro,ro,ro,ro");
    myGridEvents.setColSorting("date,str,str,str,str,str,str,str,str");
    myGridEvents.enableAlterCss("","");
    myGridEvents.init();    
    myGridEvents.attachEvent("onRowDblClicked", Detail );

    myGridEventsToolbar = myTabbar.cells("events").attachToolbar();
    myGridEventsToolbar.setIconsPath("{{ asset('/images/') }}");
    myGridEventsToolbar.loadStruct( "{{ url('xml_ATS_events_grid_toolbar') }}");
    myGridEventsToolbar.attachEvent("onClick",function(itemid){
         switch (itemid) {
            case 'refresh':
                myLayoutEvents.cells("b").progressOn();
                PageRefresh();
                break;
            case "print":
                myGridEvents.printView();
                break;
            default:
                alert(itemid);
                break;
        }
    });

    myLayoutJobs = myTabbar.cells("jobs").attachLayout("2U");
    myLayoutJobs.cells("a").setWidth(800); 
    myLayoutJobs.cells("a").setText("{{ "Jobs" | trans }}"); 
    myLayoutJobs.cells("b").setText("{{ "Detail" | trans }}"); 
    
    myGridJobs = myLayoutJobs.cells("a").attachGrid();
    myGridJobs.setImagePath( "{{ asset('/images/') }}");
    myGridJobs.setHeader("{{ "Date" | trans }},{{ "Event" | trans }},{{ "Job" | trans }},{{ "User" | trans }},{{ "Domain" | trans }}");
    myGridJobs.attachHeader("#text_filter,#select_filter,#text_filter,#select_filter,#select_filter");
    myGridJobs.setInitWidths("140,80,*,120,120");
    myGridJobs.setColAlign("left,left,left,left,left");
    myGridJobs.setColTypes("ro,ro,ro,ro,ro");
    myGridJobs.setColSorting("date,str,str,str,str");
    myGridJobs.enableAlterCss("","");
    myGridJobs.init();    
    myGridJobs.attachEvent("onRowDblClicked", Detail );

    myDetail = myLayoutJobs.cells("b").attachGrid();
    myDetail.selMultiRows = true;
//    myDetail.setImagePath( "{{ asset('/images/') }}");
    myDetail.setHeader("{{ "Attr." | trans }},{{ "Attribute" | trans }},{{ "E." | trans }}");
    myDetail.attachHeader("#text_filter,#text_filter,#text_filter");
    myDetail.setInitWidths("150,*,0");
    myDetail.setColAlign("left,left,left");
    myDetail.setColTypes("ro,ro,ro");
    myDetail.setColSorting("str,str,int");
    myDetail.enableAlterCss("","");
    myDetail.init();

}

function PageRefresh() {   
    myGridEvents.load("{{ url('xml_ATS_audit_grid') }}", function(){    
        myGridEvents.refreshFilters();
        myGridEvents.filterByAll();
        myGridJobs.load("{{ url('xml_ATS_audit_jobs') }}", function(){    
            myGridJobs.refreshFilters();
            myGridJobs.filterByAll();
        });           
    });   
}

function Detail(id) {
    myLayoutJobs.cells("b").progressOn();
    myDetail.clearAndLoad("{{ url('xml_ATS_audit_job') }}?id="+id, function(){    
        myLayoutJobs.cells("b").progressOff();
    });    
}
</script>
{% endblock %}
