{% extends "AriiCoreBundle::base.html.twig" %}
{% block dhtmlx %}
<link rel="stylesheet" type="text/css" href="{{ asset('dhtmlx/skins/terrace/dhtmlx.css') }}" />
<script src="{{ asset('dhtmlx/codebase/dhtmlx.js') }}" type="text/javascript"></script>
{% endblock dhtmlx %}
{% block dhtmlx_plus %}
<link rel="stylesheet" type="text/css" href="{{ asset('dhtmlx/skins/terrace/dhtmlx.css') }}" />
<script src="{{ asset('dhtmlx/codebase/dhtmlx.js') }}" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="{{ asset('dhtmlx_scheduler/codebase/dhtmlxscheduler.css') }}" />
<script src="{{ asset('dhtmlx_scheduler/codebase/dhtmlxscheduler.js') }}" type="text/javascript"></script>
<script src="{{ asset('dhtmlx_scheduler/codebase/ext/dhtmlxscheduler_agenda_view.js') }}" type="text/javascript"></script>
{% endblock dhtmlx_plus %}
{% block onload %}
<style>
    .arii {
        background-color: red;
    }
    p.title {
        font-size: 16px;
        padding: 0;
        margin: 0;
    }
    p.info {
        font-size: 12px;
        padding: 0;
        margin: 0;
    }   
.dhx_dataview_arii_item_selected{
    font-weight:bold !important;
    background-color: #ffffff;
}
.dhx_dataview_arii_item{
    font-size:12px !important;
}    
span.warning {
  background: orange;
  border-radius: 1em;
  -moz-border-radius: 1em;
  -webkit-border-radius: 1.2em;
  color: #ffffff;
  display: inline-block;
  font-weight: bold;
  line-height: 1.6em;
  margin-right: 5px;
  text-align: center;
  width: 1.6em; 
}    
span.error {
  background: red;
  border-radius: 1em;
  -moz-border-radius: 1em;
  -webkit-border-radius: 1.2em;
  color: #ffffff;
  display: inline-block;
  font-weight: bold;
  line-height: 1.6em;
  margin-right: 5px;
  text-align: center;
  width: 1.6em; 
}    
</style>    
<script language="javascript">
var bundle='JOC';
var update=5;

dhtmlxEvent(window,"load",function(){   
    var size=180;

    globalLayout = new dhtmlXLayoutObject(document.body,"3T");  
    globalLayout.cells("a").setHeight(120); 
    globalLayout.cells("b").setWidth(size); 
    globalLayout.cells("b").setText("{{ "Menu" | trans }}"); 

    myRibbon = globalLayout.cells("a").attachRibbon(); 
    myRibbon.setIconPath( "{{ asset('/images/') }}" );
    myRibbon.loadStruct("{{ url('json_ARII_ribbon') }}?bundle="+bundle, function() {});
    myRibbon.attachEvent("onStateChange", StateRibbon );
    myRibbon.attachEvent("onClick", ClickRibbon );

    mySidebar = globalLayout.cells("b").attachSidebar({
        icons_path: "{{ asset('/images/') }}",
        // template: "tiles",
        width: size,
        items:
        [
            { id:"orders", text: "{{ "Orders" | trans }}", icon: "order.png" },
        ]
    });
    mySidebar.attachEvent("onBubbleClick", function(id, value){
        // bubble clicked, your code here
        // 'return true' means item allowed to be selected
        // false - otherwise
        return true;
    });    
    mySidebar.attachEvent("onSelect", function(id, value){
        document.location.href = "{{ url('arii_JOC_index') }}"+id;
        return true;
    });

    myToolbar = globalLayout.cells("c").attachToolbar();
    myToolbar.setIconsPath( "{{ asset('/images/') }}" );
    Init();    
    globalLayout.cells("a").hideHeader();
    globalLayout.cells("c").hideHeader();
    GlobalRefresh();
    autorefresh = setInterval( "GlobalRefresh()",update*1000);
});
</script>
{% endblock onload %}
{% block body %}{% endblock%}
{% block script %}
<script language="javascript">
function GlobalRefresh() {
    PageRefresh();
}    
    
function SyncAll () {
    dhx4.ajax.get( "{{ url('arii_JOC_sync_all') }}" ,function(loader,response){
        if (loader.xmlDoc.responseText!='') {
            dhtmlx.message({
            type: "Error",
            expire: 10000,
            width: "500px",
            text: loader.xmlDoc.responseText });                  
        }
    });
}

function Chain(id,command,message,chain)
{
    dhtmlx.message({
        type: "Notice",
        text: message
    });
    dhtmlxAjax.get("{{ url('arii_JOC_command') }}?command="+command+"&id="+id+"&chain="+chain,function(loader){
        dhtmlx.message({
        type: "Notice",
        expire: 10000,
        width: "500px",
        text: loader.xmlDoc.responseText
        });
        GridRefresh();
    });
}

function Node(id,nid,command,message,chain)
{
    dhtmlx.message({
        type: "Notice",
        text: message
    });
    alert("{{ url('arii_JOC_command') }}?command="+command+"&node_id="+nid+"&id="+id);
    dhtmlxAjax.get("{{ url('arii_JOC_command') }}?command="+command+"&node_id="+nid+"&id="+id+"&chain="+chain,function(loader){
        dhtmlx.message({
        type: "Notice",
        expire: 10000,
        width: "500px",
        text: loader.xmlDoc.responseText
        });
        GridRefresh();
    });
}

var dhxCalendar;
var msg;

function ShowWhy( id ) { 
    largeur = 900;
    msg = dhxWins.createWindow( "msgwin" ,  (document.getElementById("wrapper").offsetWidth-largeur)/2, 50, largeur, 550 );
    msg.setText("{{ "Diagnostic" | trans }} ");

    winLayout = msg.attachLayout("1C");
    winLayout.cells("a").hideHeader();
    winLayout.cells("a").progressOn();
    
    toolbar = winLayout.cells("a").attachToolbar();
    toolbar.setIconsPath("{{ asset('/images/') }}");
    toolbar.loadStruct("{{ url('arii_JID_toolbar_job_why') }}");
    toolbar.attachEvent("onClick",function(buttonId){
        switch (buttonId) {
            case "cancel":
                msg.close();
                break;
            default:
                alert(buttonId);
        }
        return true;
    });

    var dhxgrid = winLayout.cells("a").attachGrid();
    dhxgrid.setHeader("{{ "Name" | trans }},{{ "Value" | trans }}");
    dhxgrid.setColTypes("tree,ro");
    dhxgrid.enableTreeGridLines(true);
    dhxgrid.setInitWidths("400,*");
    dhxgrid.init();
    dhxgrid.load("{{ url('arii_JOC_command') }}?command=why_job&job_id="+id, function () {
        winLayout.cells("a").progressOff();    
    });
}
</script>
{% include "AriiCoreBundle:Common:ribbon.js.twig" %}
{% endblock script %}